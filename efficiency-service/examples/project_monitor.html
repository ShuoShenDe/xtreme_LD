<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>é¡¹ç›®è¿›åº¦ç›‘æ§</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .project-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .task-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .task-list table {
            width: 100%;
            border-collapse: collapse;
        }
        .task-list th,
        .task-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .task-list th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .status-completed { color: #28a745; }
        .status-in-progress { color: #ffc107; }
        .status-pending { color: #6c757d; }
        .status-delayed { color: #dc3545; }
        .priority-high { background-color: #fff5f5; }
        .priority-medium { background-color: #fffbf0; }
        .priority-low { background-color: #f0fff4; }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-danger {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>é¡¹ç›®è¿›åº¦ç›‘æ§</h1>
            <p>é¡¹ç›®: <span id="projectName">Xtreme1æ•°æ®æ ‡æ³¨é¡¹ç›®</span> | æ›´æ–°æ—¶é—´: <span id="updateTime"></span></p>
        </div>

        <div id="alertsContainer">
            <!-- åŠ¨æ€ç”Ÿæˆè­¦å‘Šä¿¡æ¯ -->
        </div>

        <div class="project-info">
            <div class="info-card">
                <h3>é¡¹ç›®æ¦‚è§ˆ</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #667eea;" id="totalTasks">0</div>
                        <div style="color: #666;">æ€»ä»»åŠ¡æ•°</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;" id="completedTasks">0</div>
                        <div style="color: #666;">å·²å®Œæˆ</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #ffc107;" id="inProgressTasks">0</div>
                        <div style="color: #666;">è¿›è¡Œä¸­</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #dc3545;" id="delayedTasks">0</div>
                        <div style="color: #666;">å»¶æœŸä»»åŠ¡</div>
                    </div>
                </div>
            </div>
            <div class="info-card">
                <h3>æ•ˆç‡æŒ‡æ ‡</h3>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>å¹³å‡æ ‡æ³¨æ•ˆç‡</span>
                            <span id="avgEfficiency">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="efficiencyBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>è´¨é‡è¯„åˆ†</span>
                            <span id="qualityScore">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="qualityBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>å›¢é˜Ÿåä½œåº¦</span>
                            <span id="collaborationScore">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="collaborationBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h3>æ•´ä½“è¿›åº¦</h3>
            <div class="progress-bar" style="height: 30px;">
                <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666;">
                <span>å¼€å§‹æ—¶é—´: <span id="startDate">2024-01-01</span></span>
                <span>é¢„è®¡å®Œæˆ: <span id="endDate">2024-03-31</span></span>
                <span>å‰©ä½™å¤©æ•°: <span id="remainingDays">0</span></span>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <h3>æ¯æ—¥è¿›åº¦è¶‹åŠ¿</h3>
                <canvas id="progressTrendChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>å·¥å…·ä½¿ç”¨åˆ†å¸ƒ</h3>
                <canvas id="toolUsageChart"></canvas>
            </div>
        </div>

        <div class="task-list">
            <h3 style="padding: 20px; margin: 0;">ä»»åŠ¡è¯¦æƒ…</h3>
            <table>
                <thead>
                    <tr>
                        <th>ä»»åŠ¡åç§°</th>
                        <th>è´Ÿè´£äºº</th>
                        <th>ä¼˜å…ˆçº§</th>
                        <th>çŠ¶æ€</th>
                        <th>è¿›åº¦</th>
                        <th>é¢„è®¡å®Œæˆ</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="taskTableBody">
                    <!-- åŠ¨æ€å¡«å…… -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const CACHE_BUSTER = 1752584680;
        const API_BASE = 'http://localhost:8001/api/v1/events';
        
        // æ¨¡æ‹Ÿé¡¹ç›®æ•°æ®
        const mockProjectData = {
            project: {
                name: 'Xtreme1æ•°æ®æ ‡æ³¨é¡¹ç›®',
                startDate: '2024-01-01',
                endDate: '2024-03-31',
                totalTasks: 150,
                completedTasks: 89,
                inProgressTasks: 45,
                delayedTasks: 16
            },
            efficiency: {
                avgEfficiency: 78.5,
                qualityScore: 92.3,
                collaborationScore: 85.7
            },
            tasks: [
                { name: 'ç‚¹äº‘æ•°æ®æ ‡æ³¨', assignee: 'user-001', priority: 'high', status: 'in-progress', progress: 75, dueDate: '2024-02-15' },
                { name: 'å›¾åƒåˆ†ç±»æ ‡æ³¨', assignee: 'user-002', priority: 'medium', status: 'completed', progress: 100, dueDate: '2024-02-10' },
                { name: 'æ–‡æœ¬æƒ…æ„Ÿåˆ†æ', assignee: 'user-003', priority: 'low', status: 'pending', progress: 0, dueDate: '2024-03-01' },
                { name: '3Dç›®æ ‡æ£€æµ‹', assignee: 'user-004', priority: 'high', status: 'delayed', progress: 45, dueDate: '2024-02-08' },
                { name: 'è¯­ä¹‰åˆ†å‰²æ ‡æ³¨', assignee: 'user-005', priority: 'medium', status: 'in-progress', progress: 60, dueDate: '2024-02-20' }
            ]
        };

        // åŠ è½½é¡¹ç›®æ•°æ®
        async function loadProjectData() {
            try {
                updateProjectOverview();
                updateEfficiencyMetrics();
                updateProgressSection();
                createProgressTrendChart();
                createToolUsageChart();
                updateTaskTable();
                generateAlerts();
                
                document.getElementById('updateTime').textContent = new Date().toLocaleString();
                
            } catch (error) {
                console.error('åŠ è½½é¡¹ç›®æ•°æ®å¤±è´¥:', error);
            }
        }

        // æ›´æ–°é¡¹ç›®æ¦‚è§ˆ
        function updateProjectOverview() {
            const project = mockProjectData.project;
            document.getElementById('totalTasks').textContent = project.totalTasks;
            document.getElementById('completedTasks').textContent = project.completedTasks;
            document.getElementById('inProgressTasks').textContent = project.inProgressTasks;
            document.getElementById('delayedTasks').textContent = project.delayedTasks;
        }

        // æ›´æ–°æ•ˆç‡æŒ‡æ ‡
        function updateEfficiencyMetrics() {
            const efficiency = mockProjectData.efficiency;
            
            document.getElementById('avgEfficiency').textContent = `${efficiency.avgEfficiency}%`;
            document.getElementById('qualityScore').textContent = `${efficiency.qualityScore}%`;
            document.getElementById('collaborationScore').textContent = `${efficiency.collaborationScore}%`;
            
            document.getElementById('efficiencyBar').style.width = `${efficiency.avgEfficiency}%`;
            document.getElementById('efficiencyBar').textContent = `${efficiency.avgEfficiency}%`;
            
            document.getElementById('qualityBar').style.width = `${efficiency.qualityScore}%`;
            document.getElementById('qualityBar').textContent = `${efficiency.qualityScore}%`;
            
            document.getElementById('collaborationBar').style.width = `${efficiency.collaborationScore}%`;
            document.getElementById('collaborationBar').textContent = `${efficiency.collaborationScore}%`;
        }

        // æ›´æ–°è¿›åº¦éƒ¨åˆ†
        function updateProgressSection() {
            const project = mockProjectData.project;
            const progress = (project.completedTasks / project.totalTasks) * 100;
            
            document.getElementById('overallProgress').style.width = `${progress}%`;
            document.getElementById('overallProgress').textContent = `${progress.toFixed(1)}%`;
            
            document.getElementById('startDate').textContent = project.startDate;
            document.getElementById('endDate').textContent = project.endDate;
            
            const remainingDays = Math.ceil((new Date(project.endDate) - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('remainingDays').textContent = Math.max(0, remainingDays);
        }

        // åˆ›å»ºè¿›åº¦è¶‹åŠ¿å›¾
        function createProgressTrendChart() {
            const ctx = document.getElementById('progressTrendChart').getContext('2d');
            
            if (window.progressTrendChart) {
                window.progressTrendChart.destroy();
            }
            
            // æ¨¡æ‹Ÿ30å¤©çš„è¿›åº¦æ•°æ®
            const labels = [];
            const data = [];
            const startDate = new Date('2024-01-01');
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                labels.push(date.toLocaleDateString());
                data.push(Math.min(100, 30 + (i * 2.5) + Math.random() * 5));
            }
            
            window.progressTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: 'å®Œæˆè¿›åº¦ (%)',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // åˆ›å»ºå·¥å…·ä½¿ç”¨åˆ†å¸ƒå›¾
        function createToolUsageChart() {
            const ctx = document.getElementById('toolUsageChart').getContext('2d');
            
            if (window.toolUsageChart) {
                window.toolUsageChart.destroy();
            }
            
            const toolData = {
                'PCå·¥å…·': 45,
                'å›¾åƒå·¥å…·': 35,
                'æ–‡æœ¬å·¥å…·': 20
            };
            
            window.toolUsageChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(toolData),
                    datasets: [{
                        data: Object.values(toolData),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // æ›´æ–°ä»»åŠ¡è¡¨æ ¼
        function updateTaskTable() {
            const tbody = document.getElementById('taskTableBody');
            tbody.innerHTML = '';
            
            mockProjectData.tasks.forEach(task => {
                const row = document.createElement('tr');
                row.className = `priority-${task.priority}`;
                
                const statusClass = `status-${task.status}`;
                const statusText = getStatusText(task.status);
                const priorityText = getPriorityText(task.priority);
                
                row.innerHTML = `
                    <td>${task.name}</td>
                    <td>${task.assignee}</td>
                    <td>${priorityText}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>
                        <div class="progress-bar" style="height: 8px;">
                            <div class="progress-fill" style="width: ${task.progress}%"></div>
                        </div>
                        <span style="font-size: 12px;">${task.progress}%</span>
                    </td>
                    <td>${task.dueDate}</td>
                    <td>
                        <button onclick="viewTaskDetails('${task.name}')" style="padding: 4px 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            è¯¦æƒ…
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // ç”Ÿæˆè­¦å‘Šä¿¡æ¯
        function generateAlerts() {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            
            const project = mockProjectData.project;
            const delayedTasks = project.delayedTasks;
            const remainingDays = Math.ceil((new Date(project.endDate) - new Date()) / (1000 * 60 * 60 * 24));
            
            if (delayedTasks > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `âš ï¸ æœ‰ ${delayedTasks} ä¸ªä»»åŠ¡å·²å»¶æœŸï¼Œè¯·åŠæ—¶å¤„ç†ï¼`;
                alertsContainer.appendChild(alert);
            }
            
            if (remainingDays < 30) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `â° é¡¹ç›®è¿˜æœ‰ ${remainingDays} å¤©åˆ°æœŸï¼Œè¯·åŠ å¿«è¿›åº¦ï¼`;
                alertsContainer.appendChild(alert);
            }
            
            const progress = (project.completedTasks / project.totalTasks) * 100;
            if (progress > 80) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.innerHTML = `ğŸ‰ é¡¹ç›®è¿›åº¦å·²è¾¾ ${progress.toFixed(1)}%ï¼Œç»§ç»­ä¿æŒï¼`;
                alertsContainer.appendChild(alert);
            }
        }

        // è·å–çŠ¶æ€æ–‡æœ¬
        function getStatusText(status) {
            const statusMap = {
                'completed': 'å·²å®Œæˆ',
                'in-progress': 'è¿›è¡Œä¸­',
                'pending': 'å¾…å¼€å§‹',
                'delayed': 'å·²å»¶æœŸ'
            };
            return statusMap[status] || status;
        }

        // è·å–ä¼˜å…ˆçº§æ–‡æœ¬
        function getPriorityText(priority) {
            const priorityMap = {
                'high': 'é«˜',
                'medium': 'ä¸­',
                'low': 'ä½'
            };
            return priorityMap[priority] || priority;
        }

        // æŸ¥çœ‹ä»»åŠ¡è¯¦æƒ…
        function viewTaskDetails(taskName) {
            alert(`æŸ¥çœ‹ä»»åŠ¡ "${taskName}" çš„è¯¦ç»†åˆ†ææŠ¥å‘Š`);
            // è¿™é‡Œå¯ä»¥æ‰“å¼€æ¨¡æ€æ¡†æˆ–è·³è½¬åˆ°ä»»åŠ¡è¯¦æƒ…é¡µé¢
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', loadProjectData);

        // æ¯5åˆ†é’Ÿåˆ·æ–°ä¸€æ¬¡æ•°æ®
        setInterval(loadProjectData, 5 * 60 * 1000);
    </script>
</body>
</html> 