<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>项目进度监控</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        .project-info {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .info-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .progress-section {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .progress-bar {
            width: 100%;
            height: 20px;
            background-color: #e9ecef;
            border-radius: 10px;
            overflow: hidden;
            margin: 10px 0;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #28a745, #20c997);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        .charts-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .chart-container {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .task-list {
            background: white;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .task-list table {
            width: 100%;
            border-collapse: collapse;
        }
        .task-list th,
        .task-list td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #eee;
        }
        .task-list th {
            background-color: #f8f9fa;
            font-weight: 600;
        }
        .status-completed { color: #28a745; }
        .status-in-progress { color: #ffc107; }
        .status-pending { color: #6c757d; }
        .status-delayed { color: #dc3545; }
        .priority-high { background-color: #fff5f5; }
        .priority-medium { background-color: #fffbf0; }
        .priority-low { background-color: #f0fff4; }
        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .alert-warning {
            background-color: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
        }
        .alert-success {
            background-color: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
        }
        .alert-danger {
            background-color: #f8d7da;
            border: 1px solid #f5c6cb;
            color: #721c24;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>项目进度监控</h1>
            <p>项目: <span id="projectName">Xtreme1数据标注项目</span> | 更新时间: <span id="updateTime"></span></p>
        </div>

        <div id="alertsContainer">
            <!-- 动态生成警告信息 -->
        </div>

        <div class="project-info">
            <div class="info-card">
                <h3>项目概览</h3>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; margin-top: 15px;">
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #667eea;" id="totalTasks">0</div>
                        <div style="color: #666;">总任务数</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #28a745;" id="completedTasks">0</div>
                        <div style="color: #666;">已完成</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #ffc107;" id="inProgressTasks">0</div>
                        <div style="color: #666;">进行中</div>
                    </div>
                    <div>
                        <div style="font-size: 2em; font-weight: bold; color: #dc3545;" id="delayedTasks">0</div>
                        <div style="color: #666;">延期任务</div>
                    </div>
                </div>
            </div>
            <div class="info-card">
                <h3>效率指标</h3>
                <div style="margin-top: 15px;">
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>平均标注效率</span>
                            <span id="avgEfficiency">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="efficiencyBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>质量评分</span>
                            <span id="qualityScore">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="qualityBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                    <div>
                        <div style="display: flex; justify-content: space-between; margin-bottom: 5px;">
                            <span>团队协作度</span>
                            <span id="collaborationScore">0%</span>
                        </div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="collaborationBar" style="width: 0%">0%</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress-section">
            <h3>整体进度</h3>
            <div class="progress-bar" style="height: 30px;">
                <div class="progress-fill" id="overallProgress" style="width: 0%">0%</div>
            </div>
            <div style="display: flex; justify-content: space-between; margin-top: 10px; color: #666;">
                <span>开始时间: <span id="startDate">2024-01-01</span></span>
                <span>预计完成: <span id="endDate">2024-03-31</span></span>
                <span>剩余天数: <span id="remainingDays">0</span></span>
            </div>
        </div>

        <div class="charts-grid">
            <div class="chart-container">
                <h3>每日进度趋势</h3>
                <canvas id="progressTrendChart"></canvas>
            </div>
            <div class="chart-container">
                <h3>工具使用分布</h3>
                <canvas id="toolUsageChart"></canvas>
            </div>
        </div>

        <div class="task-list">
            <h3 style="padding: 20px; margin: 0;">任务详情</h3>
            <table>
                <thead>
                    <tr>
                        <th>任务名称</th>
                        <th>负责人</th>
                        <th>优先级</th>
                        <th>状态</th>
                        <th>进度</th>
                        <th>预计完成</th>
                        <th>操作</th>
                    </tr>
                </thead>
                <tbody id="taskTableBody">
                    <!-- 动态填充 -->
                </tbody>
            </table>
        </div>
    </div>

    <script>
        const CACHE_BUSTER = 1752584680;
        const API_BASE = 'http://localhost:8001/api/v1/events';
        
        // 模拟项目数据
        const mockProjectData = {
            project: {
                name: 'Xtreme1数据标注项目',
                startDate: '2024-01-01',
                endDate: '2024-03-31',
                totalTasks: 150,
                completedTasks: 89,
                inProgressTasks: 45,
                delayedTasks: 16
            },
            efficiency: {
                avgEfficiency: 78.5,
                qualityScore: 92.3,
                collaborationScore: 85.7
            },
            tasks: [
                { name: '点云数据标注', assignee: 'user-001', priority: 'high', status: 'in-progress', progress: 75, dueDate: '2024-02-15' },
                { name: '图像分类标注', assignee: 'user-002', priority: 'medium', status: 'completed', progress: 100, dueDate: '2024-02-10' },
                { name: '文本情感分析', assignee: 'user-003', priority: 'low', status: 'pending', progress: 0, dueDate: '2024-03-01' },
                { name: '3D目标检测', assignee: 'user-004', priority: 'high', status: 'delayed', progress: 45, dueDate: '2024-02-08' },
                { name: '语义分割标注', assignee: 'user-005', priority: 'medium', status: 'in-progress', progress: 60, dueDate: '2024-02-20' }
            ]
        };

        // 加载项目数据
        async function loadProjectData() {
            try {
                updateProjectOverview();
                updateEfficiencyMetrics();
                updateProgressSection();
                createProgressTrendChart();
                createToolUsageChart();
                updateTaskTable();
                generateAlerts();
                
                document.getElementById('updateTime').textContent = new Date().toLocaleString();
                
            } catch (error) {
                console.error('加载项目数据失败:', error);
            }
        }

        // 更新项目概览
        function updateProjectOverview() {
            const project = mockProjectData.project;
            document.getElementById('totalTasks').textContent = project.totalTasks;
            document.getElementById('completedTasks').textContent = project.completedTasks;
            document.getElementById('inProgressTasks').textContent = project.inProgressTasks;
            document.getElementById('delayedTasks').textContent = project.delayedTasks;
        }

        // 更新效率指标
        function updateEfficiencyMetrics() {
            const efficiency = mockProjectData.efficiency;
            
            document.getElementById('avgEfficiency').textContent = `${efficiency.avgEfficiency}%`;
            document.getElementById('qualityScore').textContent = `${efficiency.qualityScore}%`;
            document.getElementById('collaborationScore').textContent = `${efficiency.collaborationScore}%`;
            
            document.getElementById('efficiencyBar').style.width = `${efficiency.avgEfficiency}%`;
            document.getElementById('efficiencyBar').textContent = `${efficiency.avgEfficiency}%`;
            
            document.getElementById('qualityBar').style.width = `${efficiency.qualityScore}%`;
            document.getElementById('qualityBar').textContent = `${efficiency.qualityScore}%`;
            
            document.getElementById('collaborationBar').style.width = `${efficiency.collaborationScore}%`;
            document.getElementById('collaborationBar').textContent = `${efficiency.collaborationScore}%`;
        }

        // 更新进度部分
        function updateProgressSection() {
            const project = mockProjectData.project;
            const progress = (project.completedTasks / project.totalTasks) * 100;
            
            document.getElementById('overallProgress').style.width = `${progress}%`;
            document.getElementById('overallProgress').textContent = `${progress.toFixed(1)}%`;
            
            document.getElementById('startDate').textContent = project.startDate;
            document.getElementById('endDate').textContent = project.endDate;
            
            const remainingDays = Math.ceil((new Date(project.endDate) - new Date()) / (1000 * 60 * 60 * 24));
            document.getElementById('remainingDays').textContent = Math.max(0, remainingDays);
        }

        // 创建进度趋势图
        function createProgressTrendChart() {
            const ctx = document.getElementById('progressTrendChart').getContext('2d');
            
            if (window.progressTrendChart) {
                window.progressTrendChart.destroy();
            }
            
            // 模拟30天的进度数据
            const labels = [];
            const data = [];
            const startDate = new Date('2024-01-01');
            
            for (let i = 0; i < 30; i++) {
                const date = new Date(startDate);
                date.setDate(date.getDate() + i);
                labels.push(date.toLocaleDateString());
                data.push(Math.min(100, 30 + (i * 2.5) + Math.random() * 5));
            }
            
            window.progressTrendChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '完成进度 (%)',
                        data: data,
                        borderColor: 'rgb(75, 192, 192)',
                        backgroundColor: 'rgba(75, 192, 192, 0.1)',
                        tension: 0.1
                    }]
                },
                options: {
                    responsive: true,
                    scales: {
                        y: {
                            beginAtZero: true,
                            max: 100
                        }
                    }
                }
            });
        }

        // 创建工具使用分布图
        function createToolUsageChart() {
            const ctx = document.getElementById('toolUsageChart').getContext('2d');
            
            if (window.toolUsageChart) {
                window.toolUsageChart.destroy();
            }
            
            const toolData = {
                'PC工具': 45,
                '图像工具': 35,
                '文本工具': 20
            };
            
            window.toolUsageChart = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(toolData),
                    datasets: [{
                        data: Object.values(toolData),
                        backgroundColor: ['#667eea', '#764ba2', '#f093fb']
                    }]
                },
                options: {
                    responsive: true,
                    plugins: {
                        legend: {
                            position: 'bottom'
                        }
                    }
                }
            });
        }

        // 更新任务表格
        function updateTaskTable() {
            const tbody = document.getElementById('taskTableBody');
            tbody.innerHTML = '';
            
            mockProjectData.tasks.forEach(task => {
                const row = document.createElement('tr');
                row.className = `priority-${task.priority}`;
                
                const statusClass = `status-${task.status}`;
                const statusText = getStatusText(task.status);
                const priorityText = getPriorityText(task.priority);
                
                row.innerHTML = `
                    <td>${task.name}</td>
                    <td>${task.assignee}</td>
                    <td>${priorityText}</td>
                    <td class="${statusClass}">${statusText}</td>
                    <td>
                        <div class="progress-bar" style="height: 8px;">
                            <div class="progress-fill" style="width: ${task.progress}%"></div>
                        </div>
                        <span style="font-size: 12px;">${task.progress}%</span>
                    </td>
                    <td>${task.dueDate}</td>
                    <td>
                        <button onclick="viewTaskDetails('${task.name}')" style="padding: 4px 8px; background: #667eea; color: white; border: none; border-radius: 4px; cursor: pointer;">
                            详情
                        </button>
                    </td>
                `;
                
                tbody.appendChild(row);
            });
        }

        // 生成警告信息
        function generateAlerts() {
            const alertsContainer = document.getElementById('alertsContainer');
            alertsContainer.innerHTML = '';
            
            const project = mockProjectData.project;
            const delayedTasks = project.delayedTasks;
            const remainingDays = Math.ceil((new Date(project.endDate) - new Date()) / (1000 * 60 * 60 * 24));
            
            if (delayedTasks > 0) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-danger';
                alert.innerHTML = `⚠️ 有 ${delayedTasks} 个任务已延期，请及时处理！`;
                alertsContainer.appendChild(alert);
            }
            
            if (remainingDays < 30) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-warning';
                alert.innerHTML = `⏰ 项目还有 ${remainingDays} 天到期，请加快进度！`;
                alertsContainer.appendChild(alert);
            }
            
            const progress = (project.completedTasks / project.totalTasks) * 100;
            if (progress > 80) {
                const alert = document.createElement('div');
                alert.className = 'alert alert-success';
                alert.innerHTML = `🎉 项目进度已达 ${progress.toFixed(1)}%，继续保持！`;
                alertsContainer.appendChild(alert);
            }
        }

        // 获取状态文本
        function getStatusText(status) {
            const statusMap = {
                'completed': '已完成',
                'in-progress': '进行中',
                'pending': '待开始',
                'delayed': '已延期'
            };
            return statusMap[status] || status;
        }

        // 获取优先级文本
        function getPriorityText(priority) {
            const priorityMap = {
                'high': '高',
                'medium': '中',
                'low': '低'
            };
            return priorityMap[priority] || priority;
        }

        // 查看任务详情
        function viewTaskDetails(taskName) {
            alert(`查看任务 "${taskName}" 的详细分析报告`);
            // 这里可以打开模态框或跳转到任务详情页面
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', loadProjectData);

        // 每5分钟刷新一次数据
        setInterval(loadProjectData, 5 * 60 * 1000);
    </script>
</body>
</html> 