# 3D 点编辑功能使用指南

## 功能概述

本功能允许用户在选中 Polyline3D、Polygon3D 或 Segmentation3D 对象后，通过拖拽的方式在 xy、yz、xz 平面视图中修改对象的点位置。

## 支持的对象类型

- **Polyline3D (3D折线)** - 可编辑折线的各个控制点
- **Polygon3D (3D多边形)** - 可编辑多边形的顶点
- **Segmentation3D (3D分割)** - 可编辑分割对象的点

## 如何使用

### 1. 启用点编辑模式

1. 首先选择一个支持的3D对象（Polyline3D、Polygon3D 或 Segmentation3D）
2. 按下快捷键 `P` 或通过菜单启用点编辑模式
3. 启用后，选中对象的各个点会显示为绿色的控制点球体

### 2. 编辑点位置

1. **鼠标悬停**: 控制点会高亮显示为黄色
2. **点击拖拽**: 点击并拖拽控制点来移动其位置
3. **拖拽时**: 被拖拽的控制点显示为红色
4. **平面约束**: 
   - 在侧视图中，拖拽会限制在对应的平面内（xy、yz、xz）
   - 在主视图中，拖拽会限制在相机面向的平面内

### 3. 视图支持

- **主视图 (MainRenderView)**: 支持在3D空间中自由编辑点
- **侧视图 (SideRenderView)**: 支持在对应平面内编辑点
  - X轴视图: 编辑YZ平面
  - Y轴视图: 编辑XZ平面  
  - Z轴视图: 编辑XY平面

### 4. 完成编辑

1. 松开鼠标按钮完成单次编辑操作
2. 按下快捷键 `P` 退出点编辑模式
3. 选择其他对象会自动退出当前对象的点编辑模式

## 快捷键

- `P` - 切换点编辑模式开/关

## 技术特性

### 命令系统集成

- 所有点编辑操作都通过命令系统执行
- 支持撤销/重做功能 (Ctrl+Z / Ctrl+Shift+Z)
- 操作会被合并以提高性能（500ms内的连续操作）

### 视觉反馈

- **正常状态**: 绿色控制点
- **悬停状态**: 黄色控制点
- **拖拽状态**: 红色控制点
- **自动缩放**: 控制点大小根据相机距离自动调整

### 性能优化

- 使用对象池减少内存分配
- 高效的几何体更新
- 优化的射线检测

## 实现架构

1. **PointEditAction**: 处理用户交互和控制点管理
2. **UpdatePointsTransform**: 命令系统中的点变换命令
3. **点编辑集成**: 通过hack.ts集成到Editor命令系统
4. **视图配置**: 在MainRenderView和SideRenderView中启用

## 注意事项

- 点编辑模式只在选择了支持的3D对象时可用
- 编辑操作会实时更新对象的几何体
- 在不同视图之间切换时，编辑状态会保持
- 对象的其他属性（如颜色、材质）不受点编辑影响 